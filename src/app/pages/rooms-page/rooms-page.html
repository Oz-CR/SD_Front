<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="logo">Simon Says</div>
      <nav class="nav">
        <a href="#" class="nav-link">Inicio</a>
        <a href="#" class="nav-link">Ranking</a>
        <a href="#" class="nav-link">Perfil</a>
        <a href="#" class="btn-back">Volver</a>
      </nav>
    </header>

    <!-- Main Content -->
    <main class="main-content">
      <div class="page-title">
        <div class="title-badge">Salas Activas</div>
        <h1 class="main-title">Partidas Disponibles</h1>
        <p class="subtitle">
          Elige una sala y demuestra tu memoria en el desaf√≠o definitivo
        </p>
        <div class="action-buttons">
          <button class="create-room-btn" (click)="openCreateRoomModal()">
            <span class="btn-icon">+</span>
            Crear Nueva Partida
          </button>
          <button
            class="refresh-btn"
            (click)="refreshRooms()"
            [disabled]="isLoading"
          >
            <span class="refresh-icon">üîÑ</span>
            Actualizar
          </button>
        </div>
        <div class="polling-indicator" *ngIf="isPollingActive">
          <span class="polling-dot"></span>
          <span class="polling-text">Actualizando cada 5 segundos...</span>
        </div>
      </div>

      <!-- Mensaje de error -->
      <div *ngIf="error" class="error-message">
        <div class="error-icon">‚ö†Ô∏è</div>
        <p>{{ error }}</p>
        <button class="btn-retry" (click)="loadRooms()">
          Intentar nuevamente
        </button>
      </div>

      <!-- Landing de espera - Cuando el jugador est√° esperando al segundo jugador -->
      <!-- Debug: isWaitingForPlayer={{isWaitingForPlayer}}, waitingRoom={{!!waitingRoom}} -->
      <div *ngIf="isWaitingForPlayer && waitingRoom" class="waiting-landing">
        <div class="waiting-container">
          <div class="waiting-animation">
            <div class="pulsing-circle"></div>
            <div class="waiting-icon">‚è≥</div>
          </div>

          <div class="waiting-content">
            <h2 class="waiting-title">Esperando al segundo jugador...</h2>
            <p class="waiting-subtitle">
              Tu partida "{{ waitingRoom.name }}" est√° lista
            </p>

            <div class="game-info">
              <div class="info-item">
                <span class="info-label">Dificultad:</span>
                <span class="info-value"
                  >{{ waitingRoom.colorCount }} colores</span
                >
              </div>
              <div class="info-item">
                <span class="info-label">Jugadores:</span>
                <span class="info-value"
                  >{{ waitingRoom.currentPlayers }}/{{ waitingRoom.maxPlayers
                  }}</span
                >
              </div>
              <div class="info-item">
                <span class="info-label">Anfitri√≥n:</span>
                <span class="info-value">{{ waitingRoom.host }}</span>
              </div>
            </div>

            <div class="waiting-actions">
              <button class="btn-cancel" (click)="cancelWaitingRoom()">
                Cancelar Partida
              </button>
              <button class="btn-refresh" (click)="loadRooms()">
                <span class="refresh-icon">üîÑ</span>
                Actualizar
              </button>
            </div>
          </div>
        </div>

        <div class="waiting-background">
          <div class="floating-shapes">
            <div class="shape shape-1"></div>
            <div class="shape shape-2"></div>
            <div class="shape shape-3"></div>
            <div class="shape shape-4"></div>
          </div>
        </div>
      </div>

      <!-- Indicador de carga -->
      <div *ngIf="isLoading" class="loading-indicator">
        <div class="spinner"></div>
        <p>Cargando partidas...</p>
      </div>

      <!-- Grid de partidas -->
      <div class="partidas-grid" *ngIf="!isLoading && !error">
        <!-- Mensaje cuando no hay partidas -->
        <div *ngIf="rooms.length === 0" class="no-rooms-message">
          <div class="empty-icon">üéÆ</div>
          <h3>No hay partidas disponibles</h3>
          <p>S√© el primero en crear una partida emocionante</p>
          <button class="create-room-btn" (click)="openCreateRoomModal()">
            <span class="btn-icon">+</span>
            Crear Primera Partida
          </button>
        </div>

        <!-- Usar el componente room-card -->
        <app-room-card
          *ngFor="let room of rooms; trackBy: trackByRoomId"
          [room]="room"
          [isJoining]="isJoiningRoom && joiningRoom?.id === room.id"
          (joinRoomEvent)="handleJoinRoom($event)"
        ></app-room-card>
      </div>
    </main>
  </div>

  <!-- Simon Decoration -->
  <div class="simon-decoration">
    <div class="simon-mini-segment mini-segment-1"></div>
    <div class="simon-mini-segment mini-segment-2"></div>
    <div class="simon-mini-segment mini-segment-3"></div>
    <div class="simon-mini-segment mini-segment-4"></div>
    <div class="simon-mini-center"></div>
  </div>

  <script>
    const simonDecoration = document.querySelector(".simon-decoration");
    simonDecoration.addEventListener("mouseenter", function () {
      this.style.transform = "scale(1.1)";
    });

    simonDecoration.addEventListener("mouseleave", function () {
      this.style.transform = "scale(1)";
    });
  </script>

  <!-- Modal para crear nueva partida -->
  <app-create-room-modal
    [isVisible]="isModalVisible"
    (closeModalEvent)="closeModal()"
    (createRoomEvent)="onCreateRoom($event)"
  ></app-create-room-modal>
</body>
