<div class="game-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Cargando juego...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-container">
    <div class="error-icon">⚠️</div>
    <h3>Error</h3>
    <p>{{ error }}</p>
    <button class="btn-primary" (click)="backToRooms()">Volver a Salas</button>
  </div>

  <!-- Game Content -->
  <div *ngIf="!isLoading && !error" class="game-content">
    <!-- Game Header -->
    <div class="game-header">
      <div class="game-info">
        <h1 class="game-title">{{ roomName }}</h1>
        <div class="game-details">
          <span class="detail-item">
            <strong>Colores:</strong> {{ colorCount }}
          </span>
          <span class="detail-item">
            <strong>Ronda:</strong> {{ gameState?.currentRound || 0 }}
          </span>
        </div>
      </div>
      
      <button class="btn-back" (click)="backToRooms()">
        <span>←</span> Salir
      </button>
    </div>

    <!-- Game Status -->
    <div class="game-status" [class]="gameState?.status">
      <div class="status-icon">
        <span *ngIf="gameState?.status === 'waiting'">⏳</span>
        <span *ngIf="gameState?.status === 'playing' && showingSequence">👀</span>
        <span *ngIf="gameState?.status === 'playing' && !showingSequence && isPlayerTurn">🎯</span>
        <span *ngIf="gameState?.status === 'playing' && !showingSequence && !isPlayerTurn">⏱️</span>
        <span *ngIf="gameState?.status === 'finished'">🏁</span>
      </div>
      <h2 class="status-text">{{ getGameStatusText() }}</h2>
    </div>

    <!-- Scores -->
    <div *ngIf="gameStarted" class="scores-container">
      <div class="score-card">
        <div class="score-label">Jugador 1</div>
        <div class="score-value">{{ gameState?.player1Score || 0 }}</div>
      </div>
      <div class="vs-divider">VS</div>
      <div class="score-card">
        <div class="score-label">Jugador 2</div>
        <div class="score-value">{{ gameState?.player2Score || 0 }}</div>
      </div>
    </div>

    <!-- Start Game Button -->
    <div *ngIf="!gameStarted && gameState?.status === 'waiting'" class="start-container">
      <button class="btn-start" (click)="startGame()">
        <span class="start-icon">🚀</span>
        Iniciar Juego
      </button>
      <p class="start-hint">Ambos jugadores deben estar presentes para comenzar</p>
    </div>

    <!-- Color Grid -->
    <div *ngIf="availableColors.length > 0" class="color-grid" [attr.data-color-count]="availableColors.length">
      <div 
        *ngFor="let color of availableColors; trackBy: trackByColorName" 
        class="color-button"
        [id]="'color-' + color.name"
        [ngStyle]="getColorStyle(color)"
        [class.disabled]="!isPlayerTurn || showingSequence || !waitingForPlayer"
        (click)="onColorClick(color)"
      >
        <div class="color-content">
          <div class="color-name">{{ color.displayName }}</div>
        </div>
        <div class="color-overlay"></div>
      </div>
    </div>

    <!-- Current Sequence Display -->
    <div *ngIf="currentSequence.length > 0 && gameStarted" class="sequence-display">
      <h3>Secuencia Actual</h3>
      <div class="sequence-colors">
        <div 
          *ngFor="let colorName of currentSequence; let i = index"
          class="sequence-color"
          [ngStyle]="{'background-color': getColorByName(colorName)?.hexColor}"
          [attr.title]="getColorByName(colorName)?.displayName"
        >
          {{ i + 1 }}
        </div>
      </div>
    </div>

    <!-- Player Progress -->
    <div *ngIf="waitingForPlayer && playerSequence.length > 0" class="progress-container">
      <h3>Tu Progreso</h3>
      <div class="progress-bar">
        <div 
          class="progress-fill" 
          [style.width.%]="(playerSequence.length / currentSequence.length) * 100"
        ></div>
      </div>
      <p class="progress-text">
        {{ playerSequence.length }} / {{ currentSequence.length }}
      </p>
    </div>

    <!-- Game Instructions -->
    <div *ngIf="!gameStarted" class="instructions">
      <h3>🎮 Cómo Jugar</h3>
      <ul>
        <li>Observa la secuencia de colores que se muestra</li>
        <li>Repite la secuencia haciendo clic en los colores en el mismo orden</li>
        <li>Cada ronda añade un color más a la secuencia</li>
        <li>Si te equivocas, pierdes y el otro jugador gana</li>
        <li>¡Gana puntos completando secuencias!</li>
      </ul>
    </div>
  </div>
</div>
